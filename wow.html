

<!-- 
function doPost(e) {
  var data = JSON.parse(e.postData.contents);

  var ss = SpreadsheetApp.openById("YOUR_SPREADSHEET_ID");
  var usersSheet = ss.getSheetByName("Users");
  var detailsSheet = ss.getSheetByName("UserDetails");

  // === Format DateTime in AM/PM ===
  var now = new Date();
  var formattedTime = Utilities.formatDate(now, Session.getScriptTimeZone(), "dd-MMM-yyyy, hh:mm:ss a", "en_US");

  // === Check if phone exists in Users sheet ===
  var usersData = usersSheet.getRange(2, 1, usersSheet.getLastRow()-1, usersSheet.getLastColumn()).getValues();
  var userId;
  var phoneExists = false;

  for (var i = 0; i < usersData.length; i++) {
    if (usersData[i][2] == data.phone) {  // assuming phone is column 3 (C)
      phoneExists = true;
      userId = usersData[i][0];  // existing user_id
      break;
    }
  }

  // === If phone not exists, create new user_id and add to Users sheet ===
  if (!phoneExists) {
    var newUserId = "user" + (usersSheet.getLastRow() + 100); // adjust starting number
    usersSheet.appendRow([newUserId, data.name, data.phone, formattedTime]);
    userId = newUserId;
  }

  // === Add submission to UserDetails sheet ===
  detailsSheet.appendRow([
    userId,
    data.name,
    data.phone,
    data.brand,
    data.type,
    data.timeSlot,
    data.area,
    formattedTime
  ]);

  return ContentService
    .createTextOutput(JSON.stringify({ result: "success", userId: userId }))
    .setMimeType(ContentService.MimeType.JSON);
} -->


<!-- 
function doPost(e) { var sheet = SpreadsheetApp.openById("1lVQLHn6KyOINkwZ4E4VXL4vCNQPBBoB-cqt7YQY6H_4").getSheetByName("Sheet3"); var data = JSON.parse(e.postData.contents); // === Settings === var startNumber = 102; // starting user ID var lastRow = sheet.getLastRow(); var newUserId = "user" + (startNumber + lastRow - 1); // === Format DateTime in AM/PM === var now = new Date(); var formattedTime = Utilities.formatDate(now, Session.getScriptTimeZone(), "dd-MMM-yyyy, hh:mm a"); // === Insert new row just after header (row 1) === sheet.insertRowsAfter(1, 1); sheet.getRange(2, 1, 1, 8).setValues([[ newUserId, formattedTime, data.name, data.phone, data.brand, data.type, data.timeSlot, data.area ]]); return ContentService .createTextOutput(JSON.stringify({ result: "success", userId: newUserId })) .setMimeType(ContentService.MimeType.JSON); } -->